var Pe=Object.defineProperty;var Be=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var be=(e,r,s)=>r in e?Pe(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s,L=(e,r)=>{for(var s in r||(r={}))Le.call(r,s)&&be(e,s,r[s]);if(Be)for(var s of Be(r))je.call(r,s)&&be(e,s,r[s]);return e};var R=(e,r,s)=>new Promise((a,d)=>{var u=c=>{try{F(s.next(c))}catch(f){d(f)}},l=c=>{try{F(s.throw(c))}catch(f){d(f)}},F=c=>c.done?a(c.value):Promise.resolve(c.value).then(u,l);F((s=s.apply(e,r)).next())});import{_ as Ce}from"./FormItem.vue_vue_type_script_lang-5952516d.js";import{_ as Se,b as Ne,c as ke}from"./BasicForm.vue_vue_type_style_index_0_lang-79990f37.js";import{a as De,G as K,H as Q,n as ie,o as re,J as H,K as he,L as Me,v as _e,u as Oe,M as He,N as we,E as fe,e as $e,O as Ke,h as Ue}from"./index.js";import{a7 as U,Z as G,a8 as q,a9 as _,$ as We,af as Ye,l as ce,N as W,ac as x,E as ue,a0 as de,ab as oe,ai as ae,u as n,g as ze,c as z,w as J,al as Ge,x as Ae,H as Ve,h as Xe,d as qe,r as Ie,f as Z,o as Ze,an as Je,_ as Qe,aa as pe,ad as Te,aj as me,F as xe}from"./vue-07f122e3.js";import{h as et,d as Ee,a as tt}from"./helper-ea64bd4c.js";import{s as ee,d as X,ad as nt,ae as st,Z as ot,R as rt}from"./antd-5ec2f20c.js";import{u as at}from"./index-867933e1.js";function it(e,r,s,a,d,u){const l=U("Button"),F=U("BasicArrow"),c=U("FormItem"),f=U("a-col");return e.showActionButtonGroup?(G(),q(f,ae(x({key:0},e.actionColOpt)),{default:_(()=>[We("div",{style:Ye([{width:"100%"},{textAlign:e.actionColOpt.style.textAlign}])},[ce(c,null,{default:_(()=>[W(e.$slots,"resetBefore"),e.showResetButton?(G(),q(l,x({key:0,type:"default",class:"mr-2"},e.getResetBtnOptions,{onClick:e.resetAction}),{default:_(()=>[ue(de(e.getResetBtnOptions.text),1)]),_:1},16,["onClick"])):oe("",!0),W(e.$slots,"submitBefore"),e.showSubmitButton?(G(),q(l,x({key:1,type:"primary",class:"mr-2"},e.getSubmitBtnOptions),{default:_(()=>[ue(de(e.getSubmitBtnOptions.text),1)]),_:1},16)):oe("",!0),W(e.$slots,"advanceBefore"),e.showAdvancedButton&&!e.hideAdvanceBtn?(G(),q(l,{key:2,type:"link",size:"small",onClick:e.toggleAdvanced},{default:_(()=>[ue(de(e.isAdvanced?e.t("component.form.putAway"):e.t("component.form.unfold"))+" ",1),ce(F,{class:"ml-1",expand:!e.isAdvanced,up:""},null,8,["expand"])]),_:1},8,["onClick"])):oe("",!0),W(e.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):oe("",!0)}const ct=De(Se,[["render",it]]);function lt(e,r,s){const a=/^\[(.+)\]$/;if(a.test(e)){const d=e.match(a);if(d&&d[1]){const u=d[1].split(",");return r=Array.isArray(r)?r:[r],u.forEach((l,F)=>{ee(s,l.trim(),r[F])}),!0}}}function ft(e,r,s){const a=/^\{(.+)\}$/;if(a.test(e)){const d=e.match(a);if(d&&d[1]){const u=d[1].split(",");return r=K(r)?r:{},u.forEach(l=>{ee(s,l.trim(),r[l.trim()])}),!0}}}function ut({defaultValueRef:e,getSchema:r,formModel:s,getProps:a}){function d(c){var v,w;if(!K(c))return{};const f={};for(const y of Object.entries(c)){let[,p]=y;const[T]=y;if(!T||Q(p)&&p.length===0||ie(p))continue;const P=n(a).transformDateFunc;K(p)&&(p=P==null?void 0:P(p)),Q(p)&&((v=p[0])!=null&&v.format)&&((w=p[1])!=null&&w.format)&&(p=p.map(m=>P==null?void 0:P(m))),re(p)&&(p===""?p=void 0:p=p.trim()),!lt(T,p,f)&&!ft(T,p,f)&&ee(f,T,p)}return u(f)}function u(c){const f=n(a).fieldMapToTime;if(!f||!Array.isArray(f))return c;for(const[v,[w,y],p="YYYY-MM-DD"]of f){if(!v||!w||!y)continue;if(!c[v]){Reflect.deleteProperty(c,v);continue}const[T,P]=c[v],[m,b]=Array.isArray(p)?p:[p,p];c[w]=l(T,m),c[y]=l(P,b),Reflect.deleteProperty(c,v)}return c}function l(c,f){return f==="timestamp"?H(c).unix():f==="timestampStartDay"?H(c).startOf("day").unix():H(c).format(f)}function F(){const c=n(r),f={};c.forEach(v=>{const{defaultValue:w,defaultValueObj:y}=v,p=Object.keys(y||{});p.length&&p.map(T=>{f[T]=y[T],s[T]===void 0&&(s[T]=y[T])}),he(w)||(f[v.field]=w,s[v.field]===void 0&&(s[v.field]=w))}),e.value=X(f)}return{handleFormValues:d,initDefault:F}}const Y=24;function dt({advanceState:e,emit:r,getProps:s,getSchema:a,formModel:d,defaultValueRef:u}){const l=ze(),{realWidthRef:F,screenEnum:c,screenRef:f}=Me(),v=z(()=>{if(!e.isAdvanced)return 0;const m=n(s).emptySpan||0;if(_e(m))return m;if(K(m)){const{span:b=0}=m,N=n(f);return m[N.toLowerCase()]||b||0}return 0}),w=Oe(T,30);J([()=>n(a),()=>e.isAdvanced,()=>n(F)],()=>{const{showAdvancedButton:m}=n(s);m&&w()},{immediate:!0});function y(m,b=0,N=!1){const S=n(F),j=parseInt(m.md)||parseInt(m.xs)||parseInt(m.sm)||m.span||Y,$=parseInt(m.lg)||j,k=parseInt(m.xl)||$,M=parseInt(m.xxl)||k;return S<=c.LG?b+=j:S<c.XL?b+=$:S<c.XXL?b+=k:b+=M,N?(e.hideAdvanceBtn=!1,b<=Y*2?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):b>Y*2&&b<=Y*(n(s).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:b}):b>Y*(n(s).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const p=Ge({});function T(){var S;let m=0,b=0;const{baseColProps:N={}}=n(s);for(const j of n(a)){const{show:$,colProps:k}=j;let M=!0;if(He($)&&(M=$),ie($)&&(M=$({schema:j,model:d,field:j.field,values:L(L({},n(u)),d)})),M&&(k||N)){const{itemColSum:t,isAdvanced:o}=y(L(L({},N),k),m);m=t||0,o&&(b=m),p[j.field]=o}}(S=l==null?void 0:l.proxy)==null||S.$forceUpdate(),e.actionSpan=b%Y+n(v),y(n(s).actionColOptions||{span:Y},m,!0),r("advanced-change")}function P(){e.isAdvanced=!e.isAdvanced}return{handleToggleAdvanced:P,fieldsIsAdvancedMap:p}}function pt(e,r={}){const s=/^\[(.+)\]$/;if(s.test(e)){const a=e.match(s);if(a&&a[1]){const d=a[1].split(",");if(!d.length)return;const u=[];return d.forEach((l,F)=>{ee(u,F,r[l.trim()])}),u.filter(Boolean).length?u:void 0}}}function mt(e,r={}){const s=/^\{(.+)\}$/;if(s.test(e)){const a=e.match(s);if(a&&a[1]){const d=a[1].split(",");if(!d.length)return;const u={};return d.forEach(l=>{ee(u,l.trim(),r[l.trim()])}),Object.values(u).filter(Boolean).length?u:void 0}}}function ht({emit:e,getProps:r,formModel:s,getSchema:a,defaultValueRef:d,formElRef:u,schemaRef:l,handleFormValues:F}){function c(){return R(this,null,function*(){const{resetFunc:t,submitOnReset:o}=n(r);t&&ie(t)&&(yield t()),n(u)&&(Object.keys(s).forEach(i=>{const h=n(a).find(O=>O.field===i),g=h==null?void 0:h.defaultValueObj,D=Object.keys(g||{});D.length&&D.map(O=>{s[O]=g[O]}),s[i]=At(h,d,i)}),Ae(()=>$()),e("reset",Ve(s)),o&&M())})}const f=()=>n(a).map(t=>[...t.fields||[],t.field]).flat(1).filter(Boolean);function v(t){return R(this,null,function*(){const o=f(),B=".",i=o.filter(g=>String(g).indexOf(B)>=0),h=[];o.forEach(g=>{const D=n(a).find(V=>V.field===g);let O=nt(t,g);const le=Reflect.has(t,g);O=et(D==null?void 0:D.component,O);const{componentProps:te}=D||{};let C=te;typeof te=="function"&&(C=C({formModel:n(s)}));const ne=pt(g,t)||mt(g,t);if(le||ne){const V=ne||O;if(N(g))if(Array.isArray(V)){const A=[];for(const I of V)A.push(I?H(I):null);n(s)[g]=A}else n(s)[g]=V?C!=null&&C.valueFormat?V:H(V):null;else n(s)[g]=V;C!=null&&C.onChange&&(C==null||C.onChange(V)),h.push(g)}else i.forEach(V=>{try{const A=V.split(".").reduce((I,E)=>I[E],t);we(A)&&(n(s)[V]=n(A),h.push(V))}catch(A){we(d.value[V])&&(n(s)[V]=X(n(d.value[V])))}})}),S(h).catch(g=>{})})}function w(t){return R(this,null,function*(){const o=X(n(a));if(!t)return;let B=re(t)?[t]:t;re(t)&&(B=[t]);for(const i of B)y(i,o);l.value=o})}function y(t,o){if(re(t)){const B=o.findIndex(i=>i.field===t);B!==-1&&(delete s[t],o.splice(B,1))}}function p(t,o,B=!1){return R(this,null,function*(){const i=X(n(a)),h=Array.isArray(t)?t.map(O=>O.field):[t.field];if(i.find(O=>h.includes(O.field))){fe("There are schemas that have already been added");return}const g=i.findIndex(O=>O.field===o),D=K(t)?[t]:t;!o||g===-1||B?B?i.unshift(...D):i.push(...D):g!==-1&&i.splice(g+1,0,...D),l.value=i,m(t)})}function T(t){return R(this,null,function*(){let o=[];if(K(t)&&o.push(t),Q(t)&&(o=[...t]),!o.every(i=>i.component==="Divider"||Reflect.has(i,"field")&&i.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}l.value=o})}function P(t){return R(this,null,function*(){let o=[];if(K(t)&&o.push(t),Q(t)&&(o=[...t]),!o.every(h=>h.component==="Divider"||Reflect.has(h,"field")&&h.field)){fe("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[];n(a).forEach(h=>{let g;if(o.forEach(D=>{h.field===D.field&&(g=D)}),g!==void 0&&h.field===g.field){const D=$e(h,g);i.push(D)}else i.push(h)}),m(i),l.value=st(i,"field")})}function m(t){let o=[];K(t)&&o.push(t),Q(t)&&(o=[...t]);const B={},i=b();o.forEach(h=>{h.component!="Divider"&&Reflect.has(h,"field")&&h.field&&!he(h.defaultValue)&&(!(h.field in i)||he(i[h.field])||Ke(i[h.field]))&&(B[h.field]=h.defaultValue)}),v(B)}function b(){return n(u)?F(Ve(n(s))):{}}function N(t){return n(a).some(o=>o.field===t?Ee.includes(o.component):!1)}function S(t){return R(this,null,function*(){var o;return(o=n(u))==null?void 0:o.validateFields(t)})}function j(t){return R(this,null,function*(){var B;let o;return t===void 0?o=f():o=t===Array.isArray(t)?t:void 0,yield(B=n(u))==null?void 0:B.validate(o)})}function $(t){return R(this,null,function*(){var o;yield(o=n(u))==null?void 0:o.clearValidate(t)})}function k(t,o){return R(this,null,function*(){var B;yield(B=n(u))==null?void 0:B.scrollToField(t,o)})}function M(t){return R(this,null,function*(){t&&t.preventDefault();const{submitFunc:o}=n(r);if(o&&ie(o)){yield o();return}if(n(u))try{const i=yield j(),h=F(i);e("submit",h)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}return{handleSubmit:M,clearValidate:$,validate:j,validateFields:S,getFieldsValue:b,updateSchema:P,resetSchema:T,appendSchemaByField:p,removeSchemaByField:w,resetFields:c,setFieldsValue:v,scrollToField:k}}function At(e,r,s){let a=X(r.value[s]);return vt(e)?a||"":(!a&&e&&yt(e)&&(a=[0,0]),a)}function yt(e){if(e.component==="Slider"&&e.componentProps&&e.componentProps.range)return!0}function vt(e){return(e==null?void 0:e.component)&&tt.includes(e.component)}function gt(d){return R(this,arguments,function*({getSchema:e,getProps:r,formElRef:s,isInitedDefault:a}){Xe(()=>R(this,null,function*(){if(n(a)||!n(r).autoFocusFirstItem)return;yield Ae();const u=n(e),l=n(s),F=l==null?void 0:l.$el;if(!l||!F||!u||u.length===0||!u[0].component.includes("Input"))return;const f=F.querySelector(".ant-row:first-child input");f&&(f==null||f.focus())}))})}const Ft=qe({name:"BasicForm",components:{FormItem:Ce,Form:ot,Row:rt,FormAction:ct},props:Ne,emits:["advanced-change","reset","submit","register","field-value-change"],setup(e,{emit:r,attrs:s}){const a=Ie({}),d=at(),u=Ie({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),l=Z({}),F=Z(!1),c=Z({}),f=Z(null),v=Z(null),{prefixCls:w}=Ue("basic-form"),y=z(()=>L(L({},e),n(c))),p=z(()=>[w,{[`${w}--compact`]:n(y).compact}]),T=z(()=>{const{baseRowStyle:A={},rowProps:I}=n(y);return L({style:A},I)}),P=z(()=>L(L(L({},s),e),n(y))),m=z(()=>{const A=n(f)||n(y).schemas;for(const I of A){const{defaultValue:E,component:ye,componentProps:ve,isHandleDateDefaultValue:Re=!0}=I;if(Re&&E&&Ee.includes(ye)){const se=ve?ve.valueFormat:null;if(!Array.isArray(E))I.defaultValue=se?H(E).format(se):H(E);else{const ge=[];E.forEach(Fe=>{ge.push(se?H(Fe).format(se):H(Fe))}),I.defaultValue=ge}}}return n(y).showAdvancedButton?X(A.filter(I=>I.component!=="Divider")):X(A)}),{handleToggleAdvanced:b,fieldsIsAdvancedMap:N}=dt({advanceState:u,emit:r,getProps:y,getSchema:m,formModel:a,defaultValueRef:l}),{handleFormValues:S,initDefault:j}=ut({getProps:y,defaultValueRef:l,getSchema:m,formModel:a});gt({getSchema:m,getProps:y,isInitedDefault:F,formElRef:v});const{handleSubmit:$,setFieldsValue:k,clearValidate:M,validate:t,validateFields:o,getFieldsValue:B,updateSchema:i,resetSchema:h,appendSchemaByField:g,removeSchemaByField:D,resetFields:O,scrollToField:le}=ht({emit:r,getProps:y,formModel:a,getSchema:m,defaultValueRef:l,formElRef:v,schemaRef:f,handleFormValues:S});ke({resetAction:O,submitAction:$}),J(()=>n(y).model,()=>{const{model:A}=n(y);A&&k(A)},{immediate:!0}),J(()=>n(y).schemas,A=>{h(A!=null?A:[])}),J(()=>m.value,A=>{Ae(()=>{var I;(I=d==null?void 0:d.redoModalHeight)==null||I.call(d)}),!n(F)&&A!=null&&A.length&&(j(),F.value=!0)}),J(()=>a,Oe(()=>{n(y).submitOnChange&&$()},300),{deep:!0});function te(A){return R(this,null,function*(){c.value=$e(n(c)||{},A)})}function C(A,I,E){a[A]=I,r("field-value-change",A,I),E&&E.itemProps&&!E.itemProps.autoLink&&o([A]).catch(ye=>{})}function ne(A){const{autoSubmitOnEnter:I}=n(y);if(I&&A.key==="Enter"&&A.target&&A.target instanceof HTMLElement){const E=A.target;E&&E.tagName&&E.tagName.toUpperCase()=="INPUT"&&$()}}const V={getFieldsValue:B,setFieldsValue:k,resetFields:O,updateSchema:i,resetSchema:h,setProps:te,removeSchemaByField:D,appendSchemaByField:g,clearValidate:M,validateFields:o,validate:t,submit:$,scrollToField:le};return Ze(()=>{j(),r("register",V)}),L({getBindValue:P,handleToggleAdvanced:b,handleEnterPress:ne,formModel:a,defaultValueRef:l,advanceState:u,getRow:T,getProps:y,formElRef:v,getSchema:m,formActionType:V,setFormModel:C,getFormClass:p,getFormActionBindProps:z(()=>L(L({},y.value),u)),fieldsIsAdvancedMap:N},V)}});function Bt(e,r,s,a,d,u){const l=U("FormItem"),F=U("FormAction"),c=U("Row"),f=U("Form");return G(),q(f,x(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:Je(e.handleEnterPress,["enter"])}),{default:_(()=>[ce(c,ae(me(e.getRow)),{default:_(()=>[W(e.$slots,"formHeader"),(G(!0),Qe(xe,null,pe(e.getSchema,v=>(G(),q(l,{key:v.field,isAdvanced:e.fieldsIsAdvancedMap[v.field],tableAction:e.tableAction,formActionType:e.formActionType,schema:v,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},Te({_:2},[pe(Object.keys(e.$slots),w=>({name:w,fn:_(y=>[W(e.$slots,w,ae(me(y||{})))])}))]),1032,["isAdvanced","tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"]))),128)),ce(F,x(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),Te({_:2},[pe(["resetBefore","submitBefore","advanceBefore","advanceAfter"],v=>({name:v,fn:_(w=>[W(e.$slots,v,ae(me(w||{})))])}))]),1040,["onToggleAdvanced"]),W(e.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"])}const Et=De(Ft,[["render",Bt]]);export{Et as B};
